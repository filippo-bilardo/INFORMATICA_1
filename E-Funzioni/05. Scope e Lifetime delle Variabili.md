### **5. Scope e Lifetime delle Variabili**

In linguaggio C, le variabili hanno due caratteristiche fondamentali che ne definiscono il comportamento e l'uso:
- **Scope (ambito):** Determina dove una variabile è visibile e utilizzabile nel codice.
- **Lifetime (durata):** Rappresenta il periodo durante il quale la variabile esiste in memoria.

Comprendere queste proprietà è essenziale per scrivere codice efficiente e privo di errori.

---

### **Scope (Ambito) delle Variabili**

Lo **scope** si riferisce alla porzione di codice in cui una variabile è accessibile. In C, l’ambito è determinato dal punto in cui la variabile viene dichiarata e dal tipo di blocco in cui si trova.

#### **Tipi di Scope**
1. **Ambito Locale**
   - Una variabile dichiarata all'interno di una funzione o di un blocco (`{}`) ha ambito locale.
   - È visibile solo all'interno della funzione o del blocco in cui è dichiarata.

**Esempio:**
```c
#include <stdio.h>

void funzione() {
    int locale = 10; // Variabile locale
    printf("Variabile locale: %d\n", locale);
}

int main() {
    funzione();
    // printf("%d", locale); // Errore: locale non è visibile qui
    return 0;
}
```

2. **Ambito Globale**
   - Una variabile dichiarata al di fuori di tutte le funzioni ha ambito globale.
   - È visibile in tutto il file sorgente, salvo restrizioni di namespace.

**Esempio:**
```c
#include <stdio.h>

int globale = 100; // Variabile globale

void funzione() {
    printf("Variabile globale: %d\n", globale);
}

int main() {
    funzione();
    printf("Variabile globale: %d\n", globale);
    return 0;
}
```

3. **Ambito Statico (File Scope)**
   - Una variabile globale dichiarata con la parola chiave `static` è visibile solo nel file sorgente in cui è definita.
   - Protegge la variabile dall'accesso da parte di altre unità di traduzione.

**Esempio:**
```c
static int interna = 50; // Visibile solo in questo file
```

4. **Ambito di Blocco**
   - Le variabili definite all’interno di blocchi (`{}`), come in cicli `for` o blocchi condizionali, hanno ambito limitato al blocco stesso.

**Esempio:**
```c
#include <stdio.h>

int main() {
    if (1) {
        int blocco = 5;
        printf("Ambito di blocco: %d\n", blocco);
    }
    // printf("%d", blocco); // Errore: blocco non è visibile qui
    return 0;
}
```

---

### **Lifetime (Durata) delle Variabili**

Il **lifetime** di una variabile è il periodo durante il quale essa esiste in memoria. In C, la durata è determinata dal modo in cui la variabile viene dichiarata.

#### **Tipi di Lifetime**
1. **Automatico (Default per variabili locali):**
   - La variabile viene creata quando il controllo entra nel blocco in cui è dichiarata e distrutta quando il controllo esce dal blocco.
   - Memoria allocata nello **stack**.

**Esempio:**
```c
#include <stdio.h>

void funzione() {
    int automatico = 10; // Lifetime limitato alla funzione
    printf("Automatico: %d\n", automatico);
}
```

2. **Statico:**
   - La variabile esiste per tutta la durata del programma, anche se è dichiarata all'interno di una funzione.
   - Il valore della variabile persiste tra le chiamate della funzione.
   - Memoria allocata nel **data segment**.

**Esempio:**
```c
#include <stdio.h>

void funzione() {
    static int statico = 0; // Lifetime per tutto il programma
    statico++;
    printf("Statico: %d\n", statico);
}

int main() {
    funzione(); // Stampa 1
    funzione(); // Stampa 2
    return 0;
}
```

3. **Dinamico:**
   - La variabile è creata manualmente con funzioni di allocazione dinamica (`malloc`, `calloc`) e persiste finché non viene liberata con `free`.
   - Memoria allocata nell’**heap**.

**Esempio:**
```c
#include <stdio.h>
#include <stdlib.h>

int main() {
    int *dinamico = (int *)malloc(sizeof(int)); // Lifetime manuale
    *dinamico = 20;
    printf("Dinamico: %d\n", *dinamico);
    free(dinamico); // Libera la memoria
    return 0;
}
```

---

### **Confronto tra Scope e Lifetime**

| **Caratteristica** | **Scope (Ambito)**                         | **Lifetime (Durata)**                |
|---------------------|-------------------------------------------|---------------------------------------|
| **Definizione**     | Dove una variabile è visibile nel codice. | Quanto tempo una variabile esiste in memoria. |
| **Tipi**            | Locale, globale, statico, di blocco.      | Automatico, statico, dinamico.       |
| **Esempio**         | `int a = 5;` visibile solo nel blocco.    | `static int a = 5;` persiste nel tempo. |

---

### **Esempio Completo**

**Problema:** Comprendere scope e lifetime utilizzando variabili locali, globali e statiche.

**Codice:**
```c
#include <stdio.h>

int globale = 100; // Variabile globale

void funzione() {
    static int statico = 0; // Variabile statica
    int locale = 10;        // Variabile locale

    statico++;
    printf("Globale: %d, Locale: %d, Statico: %d\n", globale, locale, statico);
}

int main() {
    funzione(); // Stampa: Globale: 100, Locale: 10, Statico: 1
    funzione(); // Stampa: Globale: 100, Locale: 10, Statico: 2
    return 0;
}
```

**Output:**
```
Globale: 100, Locale: 10, Statico: 1
Globale: 100, Locale: 10, Statico: 2
```

---

### **Conclusione**

La comprensione di **scope** e **lifetime** è fondamentale per evitare errori comuni, come l'accesso a variabili non definite o la perdita di memoria (memory leaks). Utilizzare in modo appropriato i diversi tipi di variabili consente di scrivere codice leggibile, efficiente e privo di errori.

